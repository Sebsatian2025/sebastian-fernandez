<!DOCTYPE html>
<html data-bs-theme="light" lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Demo CMS - P√°gina Principal</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome5-overrides.min.css">
    <link rel="stylesheet" href="assets/css/styles.min.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="assets/css/lang.css">
    
</head>

<body class="lang-es demo-active" id="page-top">
    
    
    <div id="preloader">
        <div class="loader"></div> 
    </div>
    
    <a class="menu-toggle rounded" href="#"><i class="fa fa-bars"></i></a>
    
    <nav class="navbar navbar-expand" id="sidebar-wrapper">
        <div class="container">
            <button data-bs-toggle="collapse" class="navbar-toggler d-none" data-bs-target="#"></button>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav sidebar-nav" id="sidebar-nav">
                    <li class="nav-item sidebar-brand"><a class="nav-link active" href="#page-top"><span class="lang-es">Mi Marca</span><span class="lang-en">My Brand</span></a></li>
                    
                    <li class="nav-item sidebar-nav-item"><a class="nav-link" id="nav-link-1" href="#page-top"><span class="lang-es">Inicio</span><span class="lang-en">Home</span></a></li>
                    
                    <li class="nav-item sidebar-nav-item"><a class="nav-link" id="nav-link-2" href="#about"><span class="lang-es">Acerca</span><span class="lang-en">About</span></a></li>
                    
                    <li class="nav-item sidebar-nav-item"><a class="nav-link" id="nav-link-3" href="#services"><span class="lang-es">Servicios</span><span class="lang-en">Services</span></a></li>
                    
                    <li class="nav-item sidebar-nav-item"><a class="nav-link" id="nav-link-4" href="#portfolio"><span class="lang-es">Portafolio</span><span class="lang-en">Portfolio</span></a></li>
                    
                    <li class="nav-item sidebar-nav-item"><a class="nav-link" id="nav-link-5" href="#contact"><span class="lang-es">Contacto</span><span class="lang-en">Contact</span></a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- HEADER -->
    <header id="header-section" class="d-flex masthead" style="position: relative; overflow: hidden;">
        <div class="lang-selector-header">
            <div class="dropdown">
                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    üåê <span class="lang-es">Idioma</span><span class="lang-en">Language</span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="langDropdown">
                    <li><a class="dropdown-item lang-option" data-lang="es">Espa√±ol</a></li>
                    <li><a class="dropdown-item lang-option" data-lang="en">English</a></li>
                </ul>
            </div>
        </div>

        <img id="header-background" src="" alt="Fondo Header" class="header-cover" />

        <div id="header-content-container" class="container text-center my-auto">
            <h1 id="header-title" class="mb-1">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </h1>
            
            <h3 id="header-subtitle" class="mb-5">
                <em>
                    <span class="lang-es"></span>
                    <span class="lang-en"></span>
                </em>
            </h3>

            <a id="header-button-link" class="btn btn-primary btn-xl" role="button" href="#">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </a>
        </div>
    </header>

    <!-- ABOUT -->
    <section class="content-section" id="about-section">
        <div class="container text-center">
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <h2 id="about-title">
                        <span class="lang-es"></span> 
                        <span class="lang-en"></span>
                    </h2>
                    <p id="about-subtitle" class="lead mb-5">
                        <span class="lang-es"></span>
                        <span class="lang-en"></span>
                    </p>
                    <a id="about-button-link" class="btn btn-dark btn-xl" role="button" href="#services">
                        <span class="lang-es"></span>
                        <span class="lang-en"></span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- SERVICES -->
    <section class="text-center text-white content-section" id="services-section">
        <div class="container">
            <div class="content-section-heading">
                <h3 id="services-subtitle" class="mb-0">
                    <span class="lang-es"></span>
                    <span class="lang-en"></span>
                </h3>

                <h2 id="services-title" class="mb-5">
                    <span class="lang-es"></span>
                    <span class="lang-en"></span>
                </h2>
            </div>

            <div class="row">
                <div class="col-md-6 col-lg-3 mb-5 mb-lg-0">
                    <span id="service-icon-wrapper-1" class="rounded-circle mb-3 mx-auto service-icon">
                        <i id="service-icon-1" class="icon-screen-smartphone" aria-hidden="true"></i>
                    </span>
                    
                    <h4 id="service-title-1">
                        <strong>
                            <span class="lang-es"></span>
                            <span class="lang-en"></span>
                        </strong>
                    </h4>

                    <p id="service-desc-1" class="mb-0 text-faded">
                        <span class="lang-es"></span>
                        <span class="lang-en"></span>
                    </p>
                </div>

                <div class="col-md-6 col-lg-3 mb-5 mb-lg-0">
                    <span id="service-icon-wrapper-2" class="rounded-circle mb-3 mx-auto service-icon">
                        <i id="service-icon-2" class="icon-pencil" aria-hidden="true"></i>
                    </span>
                    <h4 id="service-title-2">
                        <strong>
                            <span class="lang-es"></span>
                            <span class="lang-en"></span>
                        </strong>
                    </h4>
                    <p id="service-desc-2" class="mb-0 text-faded">
                        <span class="lang-es"></span>
                        <span class="lang-en"></span>
                    </p>
                </div>

                <div class="col-md-6 col-lg-3 mb-5 mb-lg-0">
                    <span id="service-icon-wrapper-3" class="rounded-circle mb-3 mx-auto service-icon">
                        <i id="service-icon-3" class="icon-like" aria-hidden="true"></i>
                    </span>
                    <h4 id="service-title-3">
                        <strong>
                            <span class="lang-es"></span>
                            <span class="lang-en"></span>
                        </strong>
                    </h4>
                    <p id="service-desc-3" class="mb-0 text-faded">
                        <span class="lang-es"></span>
                        <span class="lang-en"></span>
                    </p>
                </div>

                <div class="col-md-6 col-lg-3 mb-5 mb-lg-0">
                    <span id="service-icon-wrapper-4" class="rounded-circle mb-3 mx-auto service-icon">
                        <i id="service-icon-4" class="icon-mustache" aria-hidden="true"></i>
                    </span>
                    <h4 id="service-title-4">
                        <strong>
                            <span class="lang-es"></span>
                            <span class="lang-en"></span>
                        </strong>
                    </h4>
                    <p id="service-desc-4" class="mb-0 text-faded">
                        <span class="lang-es"></span>
                        <span class="lang-en"></span>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- CALLOUT -->
    <section id="callout-section" class="content-section text-center d-flex justify-content-center align-items-center" style="background: none; position: relative; overflow: hidden;">
        <img id="callout-background" src="/democms/img/uploads/bg-callout.jpg" alt="Fondo de la secci√≥n" class="header-cover">
        <div class="container text-center">
            <h2 id="callout-title" class="mb-5 mx-auto">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </h2>

            <a id="callout-button-link" class="btn btn-primary btn-xl" role="button" href="#">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </a>
        </div>
    </section>

    <!-- PORTFOLIO -->
    <section id="portfolio" class="content-section">
        <div class="container">
            <div class="content-section-heading text-center">
                <h3 class="text-secondary mb-0" id="portfolio-subtitle">
                    <span class="lang-es"></span>
                    <span class="lang-en"></span>
                </h3>

                <h2 class="mb-5" id="portfolio-title-main">
                    <span class="lang-es"></span>
                    <span class="lang-en"></span>
                </h2>
            </div>

            <div class="row g-0">
                <div class="col-lg-6">
                    <a class="portfolio-item" href="#">
                        <div class="caption">
                            <div class="caption-content">
                                <h2 id="portfolio-title-1">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </h2>
                                <p id="portfolio-desc-1" class="mb-0">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </p>
                            </div>
                        </div>
                        <img id="portfolio-img-1" class="portfolio-img" src="assets/img/portfolio-1.jpg">
                    </a>
                </div>

                <div class="col-lg-6">
                    <a class="portfolio-item" href="#">
                        <div class="caption">
                            <div class="caption-content">
                                <h2 id="portfolio-title-2">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </h2>
                                <p id="portfolio-desc-2" class="mb-0">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </p>
                            </div>
                        </div>
                        <img id="portfolio-img-2" class="portfolio-img" src="assets/img/portfolio-2.jpg">
                    </a>
                </div>

                <div class="col-lg-6">
                    <a class="portfolio-item" href="#">
                        <div class="caption">
                            <div class="caption-content">
                                <h2 id="portfolio-title-3">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </h2>
                                <p id="portfolio-desc-3" class="mb-0">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </p>
                            </div>
                        </div>
                        <img id="portfolio-img-3" class="portfolio-img" src="assets/img/portfolio-3.jpg">
                    </a>
                </div>

                <div class="col-lg-6">
                    <a class="portfolio-item" href="#">
                        <div class="caption">
                            <div class="caption-content">
                                <h2 id="portfolio-title-4">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </h2>
                                <p id="portfolio-desc-4" class="mb-0">
                                    <span class="lang-es"></span>
                                    <span class="lang-en"></span>
                                </p>
                            </div>
                        </div>
                        <img id="portfolio-img-4" class="portfolio-img" src="assets/img/portfolio-4.jpg">
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA -->
    <section id="cta-section" class="content-section">
        <div class="container text-center">
            <h2 id="cta-title" class="mb-4">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </h2>

            <a id="cta-button-1-link" class="btn btn-light me-4 btn-xl" role="button" href="#">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </a>

            <a id="cta-button-2-link" class="btn btn-dark me-4 btn-xl" role="button" href="#">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </a>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="text-center footer" id="footer-section">
        <div class="container">
            <ul class="list-inline mb-5">
                <li class="list-inline-item">
                    <a id="footer-link-facebook" class="link-light rounded-circle social-link" href="#">
                        <i class="icon-social-facebook"></i>
                    </a>
                </li>
                <li class="list-inline-item">
                    <a id="footer-link-twitter" class="link-light rounded-circle social-link" href="#">
                        <i class="icon-social-twitter"></i>
                    </a>
                </li>
                <li class="list-inline-item">
                    <a id="footer-link-github" class="link-light rounded-circle social-link" href="#">
                        <i class="icon-social-github"></i>
                    </a>
                </li>
            </ul>
            <p id="footer-copy-text" class="text-muted mb-0 small">
                <span class="lang-es"></span>
                <span class="lang-en"></span>
            </p>
        </div>
        <a class="rounded scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a>
    </footer>
    
    <!-- Footer con bot√≥n de activaci√≥n -->
    <footer id="demo-footer" style="position: fixed; bottom: 0; left: 0; width: 100%; background: #222; padding: 12px; text-align: center; z-index: 999; display: none;">
        <button 
            id="start-demo-btn" 
            style="padding: 10px 16px; background: #00c896; color: #fff; border: none; border-radius: 6px; font-weight: bold;"
        >
            üîê Activar temporizador de demo
        </button>
    </footer>

    <!-- Temporizador visual -->
    <p id="demo-timer" style="position: fixed; bottom: 60px; right: 20px; font-weight: bold; color: #fff; background: #444; padding: 6px 10px; border-radius: 4px; display: none;">
        Tiempo restante: --
    </p>
  <!-- =================== VERIFICACI√ìN DE DEMO Y TEMPORIZADOR ===================== -->
  <script>
    (function checkDemoStatus() {
      // ‚≠ê Leer de AMBOS storages (primero sessionStorage, luego localStorage como fallback)
      let demoActive = sessionStorage.getItem('demo_active');
      let demoEndTime = parseInt(sessionStorage.getItem('demo_end_time'));
      
      // ‚≠ê Si no est√° en sessionStorage, buscar en localStorage (compartido entre pesta√±as)
      if (!demoActive || !demoEndTime) {
        demoActive = localStorage.getItem('demo_active');
        demoEndTime = parseInt(localStorage.getItem('demo_end_time'));
        
        // Si lo encontramos en localStorage, sincronizarlo a sessionStorage
        if (demoActive && demoEndTime) {
          sessionStorage.setItem('demo_active', demoActive);
          sessionStorage.setItem('demo_end_time', demoEndTime);
          console.log('‚úÖ Estado del demo sincronizado desde localStorage');
        }
      }
      
      const adminPath = '/democms/admin/';
      

      
      if (Date.now() > demoEndTime) {
        alert('‚è±Ô∏è Tu sesi√≥n de demo ha expirado.');
        sessionStorage.clear();
        localStorage.removeItem('demo_active');
        localStorage.removeItem('demo_end_time');
        localStorage.removeItem('demo_start_time');
        return;
      }
      
      console.log('‚úÖ Demo activo detectado');
      showFrontendTimer(demoEndTime);
      

    })();
    
    function showFrontendTimer(endTime) {
      const timer = document.getElementById('demo-timer');
      if (!timer) {
        console.warn('‚ö†Ô∏è Elemento #demo-timer no encontrado en el DOM');
        return;
      }
      
      timer.style.display = 'block';
      
      function update() {
        const currentEndTime = parseInt(localStorage.getItem('demo_end_time')) || 
                               parseInt(sessionStorage.getItem('demo_end_time')) || 
                               endTime;
        const remaining = currentEndTime - Date.now();
        
        if (remaining <= 0) {
          alert('‚è±Ô∏è Sesi√≥n expirada');
          sessionStorage.clear();
          localStorage.removeItem('demo_active');
          localStorage.removeItem('demo_end_time');
          localStorage.removeItem('demo_start_time');
          window.location.href = '/democms/admin/';
          return;
        }
        
        const minutes = Math.floor(remaining / 60000);
        const seconds = Math.floor((remaining % 60000) / 1000);
        timer.textContent = `‚è±Ô∏è Tiempo: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (remaining < 2 * 60 * 1000) {
          timer.style.backgroundColor = '#ff6b6b';
          timer.classList.add('warning');
        }
        
        setTimeout(update, 1000);
      }
      update();
    }
    
    // ‚≠ê 
  </script>

  <!-- =================== FUNCIONES DE UTILIDAD ====================== -->
  <script>
    const DEBUG = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    
    // Convertir objeto a YAML
    function convertDataToYAML(data) {
      let yaml = '---\n';
      for (const key in data) {
        yaml += `${key}: "${data[key]}"\n`;
      }
      yaml += '---';
      return yaml;
    }
    
    function parseFrontMatter(text) {
      const match = text.match(/---\n([\s\S]*?)\n---/);
      if (!match) return {};
      const yaml = match[1];
      const lines = yaml.split("\n");
      const data = {};
      lines.forEach(line => {
        const idx = line.indexOf(':');
        if (idx === -1) return;
        const key = line.slice(0, idx).trim();
        let value = line.slice(idx + 1).trim();
        if (value.startsWith("'") && value.endsWith("'")) {
          value = value.slice(1, -1);
        } else if (value.startsWith('"') && value.endsWith('"')) {
          value = value.slice(1, -1);
        }
        data[key] = value;
      });
      return data;
    }
    
    function cleanWhitespaceTextNodes(container) {
      if (!container || !container.childNodes) return;
      const toRemove = [];
      container.childNodes.forEach(node => {
        if (node.nodeType === Node.TEXT_NODE && /^[\s\u00A0]*$/.test(node.nodeValue)) {
          toRemove.push(node);
        }
      });
      toRemove.forEach(n => n.parentNode.removeChild(n));
    }
    
    function removeAllChildTextNodes(el) {
      if (!el || !el.childNodes) return;
      const toRemove = [];
      el.childNodes.forEach(node => {
        if (node.nodeType === Node.TEXT_NODE) toRemove.push(node);
      });
      toRemove.forEach(n => n.parentNode.removeChild(n));
    }
    
    function injectBilingualContent(el, data, keyEs, keyEn) {
      const textEs = data[keyEs] || '';
      const textEn = data[keyEn] || '';
      
      const elEs = el.querySelector('.lang-es');
      const elEn = el.querySelector('.lang-en');
      
      if (elEs) elEs.textContent = textEs;
      if (elEn) elEn.textContent = textEn;
      
      const colorKey = keyEs.replace('_es', '_color');
      if (colorKey && data[colorKey]) {
        const color = data[colorKey];
        if (elEs) elEs.style.color = color;
        if (elEn) elEn.style.color = color;
      }
    }
    
    function escapeForRegex(s) {
      return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    }
    
    function applyIconClass(el, classString) {
      const newClasses = String(classString || '').trim().split(/\s+/).filter(Boolean);
      if (!newClasses.length) return;
      const iconClassPrefixes = ['icon-', 'fa-', 'fas', 'far', 'fab', 'fi-', 'mdi-'];
      const prefixRe = new RegExp('^(?:' + iconClassPrefixes.map(escapeForRegex).join('|') + ')');
      if (el.tagName === 'I') {
        const filtered = newClasses.filter(c => /[A-Za-z_-]/.test(c));
        if (!filtered.length) return;
        el.className = filtered.join(' ');
        return;
      }
      const kept = Array.from(el.classList).filter(c => !prefixRe.test(c));
      const final = [...kept, ...newClasses].join(' ').trim();
      el.className = final;
    }
    
    // ============================================================================
    // MAPEO DE CAMPOS A ELEMENTOS
    // ============================================================================
    
    const mappings = {
      navigation: {
        nav_link_1_text_es: "nav-link-1",
        nav_link_1_href: "nav-link-1",
        nav_link_2_text_es: "nav-link-2",
        nav_link_2_href: "nav-link-2",
        nav_link_3_text_es: "nav-link-3",
        nav_link_3_href: "nav-link-3",
        nav_link_4_text_es: "nav-link-4",
        nav_link_4_href: "nav-link-4",
        nav_link_5_text_es: "nav-link-5",
        nav_link_5_href: "nav-link-5"
      },      
      header: {
        header_background: "header-background",
        header_background_color: "header-section",
        header_background_mode: "header-section",
        header_title_es: "header-title",
        header_subtitle_es: "header-subtitle",
        header_button_link: "header-button-link",
        header_button_text_es: "header-button-link",
        header_title_color: "header-title",
        header_subtitle_color: "header-subtitle",
        header_button_bg_color: "header-button-link",
        header_button_text_color: "header-button-link"
      },
      about: {
        about_background_color: "about-section",
        about_title_es: "about-title",
        about_subtitle_es: "about-subtitle",
        about_button_link: "about-button-link",
        about_button_text_es: "about-button-link"
      },
      services: {
        services_background_color: "services-section",
        services_subtitle_color: "services-subtitle",
        services_subtitle_es: "services-subtitle",
        services_title_es: "services-title",
        service_icon_1_class: "service-icon-1",
        service_icon_1_color: "service-icon-1",
        service_icon_1_size: "service-icon-1",
        service_icon_1_bg: "service-icon-wrapper-1",
        service_title_1_es: "service-title-1",
        service_desc_1_es: "service-desc-1",
        service_icon_2_class: "service-icon-2",
        service_icon_2_color: "service-icon-2",
        service_icon_2_size: "service-icon-2",
        service_icon_2_bg: "service-icon-wrapper-2",
        service_title_2_es: "service-title-2",
        service_desc_2_es: "service-desc-2",
        service_icon_3_class: "service-icon-3",
        service_icon_3_color: "service-icon-3",
        service_icon_3_size: "service-icon-3",
        service_icon_3_bg: "service-icon-wrapper-3",
        service_title_3_es: "service-title-3",
        service_desc_3_es: "service-desc-3",
        service_icon_4_class: "service-icon-4",
        service_icon_4_color: "service-icon-4",
        service_icon_4_size: "service-icon-4",
        service_icon_4_bg: "service-icon-wrapper-4",
        service_title_4_es: "service-title-4",
        service_desc_4_es: "service-desc-4"
      },
      portfolio: {
        portfolio_subtitle_es: "portfolio-subtitle",
        portfolio_title_main_es: "portfolio-title-main",
        portfolio_img_1: "portfolio-img-1",
        portfolio_img_2: "portfolio-img-2",
        portfolio_img_3: "portfolio-img-3",
        portfolio_img_4: "portfolio-img-4",
        portfolio_title_1_es: "portfolio-title-1",
        portfolio_title_2_es: "portfolio-title-2",
        portfolio_title_3_es: "portfolio-title-3",
        portfolio_title_4_es: "portfolio-title-4",
        portfolio_desc_1_es: "portfolio-desc-1",
        portfolio_desc_2_es: "portfolio-desc-2",
        portfolio_desc_3_es: "portfolio-desc-3",
        portfolio_desc_4_es: "portfolio-desc-4"
      },
      callout: {
        callout_background: "callout-background",
        callout_title_es: "callout-title",
        callout_button_link: "callout-button-link",
        callout_button_text_es: "callout-button-link"
      },
      cta: {
        cta_background_color: "cta-section",
        cta_title_text_color: "cta-title",
        cta_title_es: "cta-title",
        cta_button_1_text_es: "cta-button-1-link",
        cta_button_1_link: "cta-button-1-link",
        cta_button_2_text_es: "cta-button-2-link",
        cta_button_2_link: "cta-button-2-link"
      },
      footer: {
        footer_link_facebook: "footer-link-facebook",
        footer_link_twitter: "footer-link-twitter",
        footer_link_github: "footer-link-github",
        footer_copy_text_es: "footer-copy-text"
      },

    };
    
    // ============================================================================
    // APLICAR CAMBIOS AL DOM (L√ìGICA COMPLETA)
    // ============================================================================
    
    window.applyCMSUpdate = (file, rawData) => {
      const section = file.replace('.md', '');
      
      // ‚≠ê Si rawData es un objeto, usarlo directamente
      let data = rawData;
      if (typeof rawData === 'string') {
        data = parseFrontMatter(rawData);
      }
      
      const mapping = mappings[section] || {};
      
      let updatedCount = 0;
      for (const key in mapping) {
        const elementId = mapping[key];
        const el = document.getElementById(elementId);
        if (!el || typeof data[key] === 'undefined') continue;
        
        const rawValue = String(data[key]).trim();
        // === BLOQUE ESPECIAL PARA NAVIGATION ===
if (section === 'navigation' && el.tagName === 'A') {
  if (key.endsWith('_text_es')) {
    const esSpan = el.querySelector('.lang-es');
    const enSpan = el.querySelector('.lang-en');
    if (esSpan) esSpan.textContent = rawValue;
    const keyEn = key.replace('_es', '_en');
    if (enSpan && typeof data[keyEn] === 'string') enSpan.textContent = data[keyEn];
    updatedCount++;
    continue;
  }
  if (key.endsWith('_href')) {
    el.setAttribute('href', rawValue);
    updatedCount++;
    continue;
  }
}

        // ========== HEADER BACKGROUND MODE ==========
        if (key === 'header_background_mode') {
          const header = document.getElementById('header-section');
          const img = document.getElementById('header-background');
          const mode = rawValue.toLowerCase();
          
          console.log(`üé® [MODE] Aplicando modo: ${mode}`);
          
          if (mode === 'image') {
            const src = data['header_background'];
            if (src) {
              console.log(`üì∏ Modo IMAGE: mostrando imagen ${src}`);
              if (img) {
                img.src = src;
                img.style.display = 'block';
                img.style.position = 'absolute';
                img.style.top = '0';
                img.style.left = '0';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.style.zIndex = '0';
              }
              if (header) {
                header.style.backgroundImage = 'none !important';
                header.style.backgroundColor = 'transparent !important';
              }
            }
          } else if (mode === 'color') {
            const color = data['header_background_color'];
            console.log(`üé® Modo COLOR: aplicando color ${color}`);
            if (header) {
              header.style.backgroundColor = color || '';
              header.style.backgroundImage = 'none';
            }
            if (img) {
              img.style.display = 'none';
            }
          }
          continue;
        }
        
        // ========== TEXTOS BILING√úES ==========
        if (key.endsWith('_es') && !key.includes('_link') && !key.includes('_color') && !key.includes('_bg')) {
          const keyEn = key.replace('_es', '_en');
          if (key.includes('_desc_')) {
            const elEs = el.querySelector('.lang-es') || el;
            const elEn = el.querySelector('.lang-en');
            if (typeof marked !== 'undefined' && !/^(BUTTON|A|SPAN|H1|H2|H3|H4|H5|H6)$/.test(el.tagName)) {
              elEs.innerHTML = marked.parse(rawValue);
              if (elEn) elEn.innerHTML = marked.parse(data[keyEn] || '');
            } else {
              elEs.textContent = rawValue;
              if (elEn) elEn.textContent = data[keyEn] || '';
            }
          } else {
            injectBilingualContent(el, data, key, keyEn);
          }
          updatedCount++;
          continue;
        }
        
        // ========== ICONOS ==========
        if (/^service_icon_\d+_class$/.test(key) || key.includes('_icon_class')) {
          if (el.tagName === 'I') applyIconClass(el, rawValue);
          updatedCount++;
          continue;
        }
        
        if (el.tagName === 'I' && !rawValue.startsWith('#') && /[A-Za-z_-]/.test(rawValue) && !rawValue.includes('\n')) {
          applyIconClass(el, rawValue);
          updatedCount++;
          continue;
        }
        
        // ========== IM√ÅGENES (IMG tags) ==========
        if (el && el.tagName === 'IMG') {
          if (rawValue.startsWith('data:')) {
            el.src = rawValue;
            el.style.display = 'block';
            updatedCount++;
            console.log(`‚úÖ [IMG] ${key}: Base64 aplicado`);
          } else {
            el.src = rawValue;
            el.style.display = 'block';
            updatedCount++;
            console.log(`‚úÖ [IMG] ${key}: URL aplicada ‚Üí ${rawValue.substring(0, 50)}`);
          }
          continue;
        }
        
        // ========== IM√ÅGENES DE FONDO (DIV, SECTION, etc) ==========
        if (key.includes('_background') && !key.includes('_color') && !key.includes('_mode')) {
          console.log(`üü° [BACKGROUND DIV/SECTION] Procesando: ${key}`);
          
          if (el && el.tagName !== 'IMG' && el.tagName !== 'A') {
            if (rawValue) {
              console.log(`üì∏ Intentando cargar imagen: ${rawValue}`);
              const img = new Image();
              img.src = rawValue;
              img.onload = () => {
                console.log(`‚úÖ Imagen CARGADA EXITOSAMENTE`);
                el.style.backgroundImage = `url("${rawValue}")`;
                el.style.backgroundSize = 'cover';
                el.style.backgroundPosition = 'center';
                el.style.backgroundRepeat = 'no-repeat';
                updatedCount++;
                console.log(`‚úÖ BACKGROUND APLICADO a:`, el);
              };
              img.onerror = (e) => {
                console.error(`‚ùå ERROR al cargar imagen: ${rawValue}`, e);
              };
            } else {
              el.style.backgroundImage = '';
              updatedCount++;
            }
            continue;
          }
        }
        
        // ========== COLORES DE ICONOS ==========
        if (/^service_icon_\d+_color$/.test(key)) {
          if (el.tagName === 'I') {
            if (rawValue) el.style.color = rawValue;
            else el.style.color = '';
          }
          updatedCount++;
          continue;
        }
        
        if (/^service_icon_\d+_size$/.test(key)) {
          if (el.tagName === 'I') {
            const px = Number(rawValue) || 0;
            if (px > 0) {
              el.style.fontSize = px + 'px';
              el.style.lineHeight = px + 'px';
            } else {
              el.style.fontSize = '';
              el.style.lineHeight = '';
            }
          }
          updatedCount++;
          continue;
        }
        
        if (/^service_icon_\d+_bg$/.test(key)) {
          const wrapper = el;
          if (wrapper) {
            if (rawValue) {
              wrapper.style.backgroundColor = rawValue;
              const m = key.match(/^service_icon_(\d+)_bg$/);
              const idx = m ? m[1] : null;
              const sizeKey = idx ? `service_icon_${idx}_size` : null;
              const iconSize = sizeKey && typeof data[sizeKey] !== 'undefined' ? Number(data[sizeKey]) : 36;
              const diameterFactor = 3.11;
              const diameter = Math.round(iconSize * diameterFactor);
              wrapper.style.width = diameter + 'px';
              wrapper.style.height = diameter + 'px';
              wrapper.style.display = 'inline-flex';
              wrapper.style.alignItems = 'center';
              wrapper.style.justifyContent = 'center';
              wrapper.style.borderRadius = '50%';
            } else {
              wrapper.style.backgroundColor = '';
              wrapper.style.width = '';
              wrapper.style.height = '';
              wrapper.style.display = '';
            }
          }
          updatedCount++;
          continue;
        }
        
        // ========== BOT√ìN HEADER ==========
        if (key === 'header_button_bg_color') {
          cleanWhitespaceTextNodes(el);
          if (rawValue) {
            el.style.backgroundColor = rawValue;
            el.style.borderColor = rawValue;
          } else {
            el.style.backgroundColor = '';
            el.style.borderColor = '';
          }
          const textColor = data['header_button_text_color'];
          if (textColor) {
            const spans = el.querySelectorAll('.lang-es, .lang-en');
            spans.forEach(span => {
              span.style.color = textColor;
            });
          }
          updatedCount++;
          continue;
        }
        // ‚≠ê‚≠ê‚≠ê AGREGAR ESTO AQU√ç ‚≠ê‚≠ê‚≠ê
// ========================================================
// BOT√ìN HEADER: Link del bot√≥n (ESPEC√çFICO)
// ========================================================
if (key === 'header_button_link') {
  if (rawValue && /^(#|https?:\/\/)/.test(rawValue)) {
    el.href = rawValue;
    
    // ‚≠ê Si es externo (https://), abrir en nueva pesta√±a
    if (/^https?:\/\//.test(rawValue)) {
      el.target = '_blank';
      el.rel = 'noopener noreferrer';
      console.log(`‚úÖ [HEADER BUTTON] Link externo aplicado: ${rawValue} (nueva pesta√±a)`);
    } else {
      // ‚≠ê Si es interno (#about), remover target para que abra en la misma pesta√±a
      el.removeAttribute('target');
      el.removeAttribute('rel');
      console.log(`‚úÖ [HEADER BUTTON] Link interno aplicado: ${rawValue} (misma pesta√±a)`);
    }
    
    updatedCount++;
  }
  continue;
}

// ‚≠ê AGREGAR AQU√ç ‚≠ê
// BOT√ìN DEL HEADER: Color del texto del bot√≥n
if (key === 'header_button_text_color') {
  if (rawValue) {
    const spans = el.querySelectorAll('.lang-es, .lang-en');
    spans.forEach(span => {
      span.style.color = rawValue;
    });
  }
  continue;
}
// ‚≠ê FIN ‚≠ê
// ‚≠ê‚≠ê‚≠ê FIN ‚≠ê‚≠ê‚≠ê
        // ========== ENLACES ==========
        if (el.tagName === 'A') {
          if (/^(#|https?:\/\/)/.test(rawValue)) {
            el.href = rawValue;
            updatedCount++;
            console.log(`  ‚úì ${key}: enlace ‚Üí ${rawValue}`);
          }
          continue;
        }
        
        if (key.includes('_background_color')) {
          const mode = data['header_background_mode'];
          if (mode === 'image') {
            console.log(`‚è≠Ô∏è Saltando ${key} porque modo es IMAGE`);
            updatedCount++;
            continue;
          }
          
          if (el && el.id === 'header-section') {
            el.style.backgroundColor = rawValue;
            el.style.backgroundImage = 'none';
          } else if (el) {
            el.style.backgroundColor = rawValue;
          }
          updatedCount++;
          continue;
        }
        
        if (key.includes('_color')) {
          if (rawValue) el.style.color = rawValue;
          updatedCount++;
          continue;
        }
        
        if (el.tagName === 'SPAN') {
          removeAllChildTextNodes(el);
          el.textContent = rawValue;
          updatedCount++;
          continue;
        }
        
        if (/^[\w- ]+$/.test(rawValue) && !rawValue.includes('\n')) {
          el.textContent = rawValue;
        } else {
          if (typeof marked !== 'undefined' && !/^(BUTTON|A|SPAN|H1|H2|H3|H4|H5|H6)$/.test(el.tagName)) {
            el.innerHTML = marked.parse(rawValue);
          } else {
            el.textContent = rawValue;
          }
        }
        updatedCount++;
      }
      
      if (updatedCount > 0) {
        console.log(`‚ú® ${section}: ${updatedCount} elementos actualizados`);
      } else {
        console.warn(`‚ö†Ô∏è ${section}: No se actualiz√≥ ning√∫n elemento`);
      }
    };
  </script>

  <!-- MANEJO DE IDIOMA -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Evitar que el sidebar se cierre al tocar el dropdown
      const dropdownLinks = document.querySelectorAll(".dropdown-item.lang-option");
    
      dropdownLinks.forEach(link => {
        link.addEventListener("click", (e) => {
          e.stopPropagation();
        });
      });
    
      // Cambio de idioma
      const langOptions = document.querySelectorAll(".lang-option");
      langOptions.forEach(opt => {
        opt.addEventListener("click", () => {
          const lang = opt.dataset.lang;
          if (lang === "en") {
            document.body.classList.remove("lang-es");
            document.body.classList.add("lang-en");
            localStorage.setItem('selected-lang', 'en');
          } else {
            document.body.classList.remove("lang-en");
            document.body.classList.add("lang-es");
            localStorage.setItem('selected-lang', 'es');
          }
        });
      });
    
      // RECUPERAR idioma guardado al cargar p√°gina
      const savedLang = localStorage.getItem('selected-lang') || 'es';
      if (savedLang === 'en') {
        document.body.classList.remove('lang-es');
        document.body.classList.add('lang-en');
      } else {
        document.body.classList.remove('lang-en');
        document.body.classList.add('lang-es');
      }
    });
  </script>

  <!-- Scripts externos -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/loadSection.js"></script>
  <script src="assets/js/script.min.js"></script>
  <!-- =================== BROADCAST CHANNEL LISTENER ====================== -->
  <script>
    (function() {
      const DEBUG = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
      
      // ‚≠ê CREAR CANAL DE BROADCAST (mismo nombre que en admin)
      const broadcastChannel = new BroadcastChannel('cms-preview-sync');
      
      if (DEBUG) console.log('üì° Broadcast Channel activado en frontend');
      
      // ‚≠ê ESCUCHAR MENSAJES DEL ADMIN
      broadcastChannel.onmessage = (event) => {
        if (event.data.type === 'cms-data-update') {
          try {
            const payload = JSON.parse(event.data.payload);
            const timestamp = new Date(event.data.timestamp).toLocaleTimeString();
            
            console.log(`üì° Datos recibidos v√≠a Broadcast: ${payload.slug} @ ${timestamp}`);
            console.log('üì¶ Datos:', payload.data);
            
            // Guardar en localStorage local
            localStorage.setItem('sveltia-live-preview', event.data.payload);
            
            // Aplicar cambios inmediatamente
            if (typeof applyCMSUpdate === 'function') {
              applyCMSUpdate(payload.slug + '.md', payload.data);
            }
          } catch (e) {
            console.error('‚ùå Error procesando broadcast:', e);
          }
        }
      };
      
// ‚≠ê CARGAR DATOS INICIALES AL ABRIR LA VENTANA
// ‚ö†Ô∏è IMPORTANTE: Esperar a que loadSection.js termine primero
window.addEventListener('load', () => {
  // ‚≠ê ESPERAR 3 SEGUNDOS para que loadSection.js termine
  setTimeout(() => {
    console.log('üîÑ Cargando datos del CMS sobre los archivos originales...');
    
    // CARGAR LA √öLTIMA SECCI√ìN EDITADA
    const stored = localStorage.getItem('sveltia-live-preview');
    if (stored) {
      try {
        const payload = JSON.parse(stored);
        const timestamp = new Date(payload.timestamp).toLocaleTimeString();
        console.log(`üü¢ Cargando √∫ltima secci√≥n editada: ${payload.slug} @ ${timestamp}`);
        console.log('üì¶ Datos:', payload.data);
        
        // Aplicar datos guardados
        if (typeof applyCMSUpdate === 'function') {
          applyCMSUpdate(payload.slug + '.md', payload.data);
        }
      } catch (e) {
        console.error('‚ùå Error cargando datos iniciales:', e);
      }
    }
    
    // ‚≠ê NUEVO: CARGAR TODAS LAS SECCIONES GUARDADAS
    const sections = ['header', 'navigation', 'about', 'services', 'portfolio', 'callout', 'cta', 'footer'];
    
    sections.forEach(section => {
      const key = `sveltia-live-preview-${section}`;
      const data = localStorage.getItem(key);
      
      if (data) {
        try {
          const payload = JSON.parse(data);
          console.log(`üìù Cargando secci√≥n guardada: ${section}`);
          
          if (typeof applyCMSUpdate === 'function') {
            applyCMSUpdate(section + '.md', payload.data);
          }
        } catch (e) {
          console.error(`‚ùå Error cargando ${section}:`, e);
        }
      }
    });
    
    console.log('‚úÖ Datos del CMS cargados sobre los archivos originales');
  }, 1500); // ‚≠ê ESPERAR 3 segundos
});
      
    })();
  </script>
<script>
  // Espera y luego forza update a navigation cuando el men√∫ visible ya est√° seguro en el DOM
  document.addEventListener("DOMContentLoaded", function() {
    setTimeout(function(){
      if(typeof applyCMSUpdate==='function'){
        const navDataRaw = localStorage.getItem('sveltia-live-preview-navigation');
        if(navDataRaw){
          try {
            const navData = JSON.parse(navDataRaw);
            applyCMSUpdate('navigation.md', navData.data || navData);
          } catch(e){console.error(e);}
        }
      }
    }, 700); // Ajusta el tiempo si tu men√∫ se renderiza m√°s tarde
  });
  </script>
  
</body>
</html>
